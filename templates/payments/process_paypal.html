{% extends 'base.html' %}

{% block title %}Procéder au paiement avec PayPal - {{ block.super }}{% endblock %}

{% block content %}
<div class="bg-gray-100 dark:bg-gray-900 py-16">
    <div class="max-w-lg mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 text-center">
            
            <div class="mb-6">
                <i class="fab fa-paypal text-6xl text-blue-600"></i>
            </div>

            <h1 class="text-3xl font-bold text-gray-900 dark:text-white mb-4">Finaliser sur PayPal</h1>
            <p class="text-lg text-gray-600 dark:text-gray-400 mb-8">
                Cliquez sur le bouton ci-dessous pour être redirigé vers le site sécurisé de PayPal et terminer votre paiement.
            </p>

            <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-6 text-left space-y-4 mb-8">
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Cours :</span>
                    <span class="font-semibold text-gray-900 dark:text-white">{{ payment.course.title }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-gray-600 dark:text-gray-300">Montant :</span>
                    <span class="font-semibold text-gray-900 dark:text-white">{{ payment.amount }} {{ payment.currency }}</span>
                </div>
            </div>

            <!-- Formulaire PayPal caché -->
            <div class="hidden">
                {{ form.render }}
            </div>

            <!-- Notre bouton personnalisé -->
            <button id="custom-paypal-button" class="w-full bg-blue-800 hover:bg-blue-900 text-white py-3 px-6 rounded-lg font-semibold text-lg transition-colors flex items-center justify-center">
                <i class="fab fa-paypal mr-3"></i>
                Payer avec PayPal
            </button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const customButton = document.getElementById('custom-paypal-button');
    
    // Le bouton généré par form.render est une image avec un input.
    // Nous devons trouver cet input pour le cliquer.
    const realPaypalButton = document.querySelector('input[type="image"][name="submit"]');

    if (customButton && realPaypalButton) {
        customButton.addEventListener('click', function() {
            // Désactiver notre bouton pour éviter les double-clics
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Redirection...';
            
            // Cliquer sur le vrai bouton PayPal (qui est caché)
            realPaypalButton.click();
        });
    }
});
</script>
{% endblock %}
